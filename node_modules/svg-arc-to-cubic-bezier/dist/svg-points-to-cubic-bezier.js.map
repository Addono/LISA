{"version":3,"file":"svg-points-to-cubic-bezier.js","sources":["../src/index.js"],"sourcesContent":["const TAU = Math.PI * 2\n\nconst mapToEllipse = ({ x, y }, rx, ry, cosphi, sinphi, centerx, centery) => {\n  x *= rx\n  y *= ry\n\n  const xp = cosphi * x - sinphi * y\n  const yp = sinphi * x + cosphi * y\n\n  return {\n    x: xp + centerx,\n    y: yp + centery\n  }\n}\n\nconst approxUnitArc = (ang1, ang2) => {\n  const a = 4 / 3 * Math.tan(ang2 / 4)\n\n  const x1 = Math.cos(ang1)\n  const y1 = Math.sin(ang1)\n  const x2 = Math.cos(ang1 + ang2)\n  const y2 = Math.sin(ang1 + ang2)\n\n  return [\n    {\n      x: x1 - y1 * a,\n      y: y1 + x1 * a\n    },\n    {\n      x: x2 + y2 * a,\n      y: y2 - x2 * a\n    },\n    {\n      x: x2,\n      y: y2\n    }\n  ]\n}\n\nconst vectorAngle = (ux, uy, vx, vy) => {\n  const sign = (ux * vy - uy * vx < 0) ? -1 : 1\n  const umag = Math.sqrt(ux * ux + uy * uy)\n  const vmag = Math.sqrt(ux * ux + uy * uy)\n  const dot = ux * vx + uy * vy\n\n  let div = dot / (umag * vmag)\n\n  if (div > 1) {\n    div = 1\n  }\n\n  if (div < -1) {\n    div = -1\n  }\n\n  return sign * Math.acos(div)\n}\n\nconst getArcCenter = (\n  px,\n  py,\n  cx,\n  cy,\n  rx,\n  ry,\n  largeArcFlag,\n  sweepFlag,\n  sinphi,\n  cosphi,\n  pxp,\n  pyp\n) => {\n  const rxsq = Math.pow(rx, 2)\n  const rysq = Math.pow(ry, 2)\n  const pxpsq = Math.pow(pxp, 2)\n  const pypsq = Math.pow(pyp, 2)\n\n  let radicant = (rxsq * rysq) - (rxsq * pypsq) - (rysq * pxpsq)\n\n  if (radicant < 0) {\n    radicant = 0\n  }\n\n  radicant /= (rxsq * pypsq) + (rysq * pxpsq)\n  radicant = Math.sqrt(radicant) * (largeArcFlag === sweepFlag ? -1 : 1)\n\n  const centerxp = radicant * rx / ry * pyp\n  const centeryp = radicant * -ry / rx * pxp\n\n  const centerx = cosphi * centerxp - sinphi * centeryp + (px + cx) / 2\n  const centery = sinphi * centerxp + cosphi * centeryp + (py + cy) / 2\n\n  const vx1 = (pxp - centerxp) / rx\n  const vy1 = (pyp - centeryp) / ry\n  const vx2 = (-pxp - centerxp) / rx\n  const vy2 = (-pyp - centeryp) / ry\n\n  let ang1 = vectorAngle(1, 0, vx1, vy1)\n  let ang2 = vectorAngle(vx1, vy1, vx2, vy2)\n\n  if (sweepFlag === 0 && ang2 > 0) {\n    ang2 -= TAU\n  }\n\n  if (sweepFlag === 1 && ang2 < 0) {\n    ang2 += TAU\n  }\n\n  return [ centerx, centery, ang1, ang2 ]\n}\n\nconst arcToBezier = ({\n  px,\n  py,\n  cx,\n  cy,\n  rx,\n  ry,\n  xAxisRotation = 0,\n  largeArcFlag = 0,\n  sweepFlag = 0\n}) => {\n  const curves = []\n\n  if (rx === 0 || ry === 0) {\n    return []\n  }\n\n  const sinphi = Math.sin(xAxisRotation * TAU / 360)\n  const cosphi = Math.cos(xAxisRotation * TAU / 360)\n\n  const pxp = cosphi * (px - cx) / 2 + sinphi * (py - cy) / 2\n  const pyp = -sinphi * (px - cx) / 2 + cosphi * (py - cy) / 2\n\n  if (pxp === 0 && pyp === 0) {\n    return []\n  }\n\n  rx = Math.abs(rx)\n  ry = Math.abs(ry)\n\n  const lambda =\n    Math.pow(pxp, 2) / Math.pow(rx, 2) +\n    Math.pow(pyp, 2) / Math.pow(ry, 2)\n\n  if (lambda > 1) {\n    rx *= Math.sqrt(lambda)\n    ry *= Math.sqrt(lambda)\n  }\n\n  let [ centerx, centery, ang1, ang2 ] = getArcCenter(\n    px,\n    py,\n    cx,\n    cy,\n    rx,\n    ry,\n    largeArcFlag,\n    sweepFlag,\n    sinphi,\n    cosphi,\n    pxp,\n    pyp\n  )\n\n  const segments = Math.max(Math.ceil(Math.abs(ang2) / (TAU / 4)), 1)\n\n  ang2 /= segments\n\n  for (let i = 0; i < segments; i++) {\n    curves.push(approxUnitArc(ang1, ang2))\n    ang1 += ang2\n  }\n\n  return curves.map(curve => {\n    const { x: x1, y: y1 } = mapToEllipse(curve[ 0 ], rx, ry, cosphi, sinphi, centerx, centery)\n    const { x: x2, y: y2 } = mapToEllipse(curve[ 1 ], rx, ry, cosphi, sinphi, centerx, centery)\n    const { x, y } = mapToEllipse(curve[ 2 ], rx, ry, cosphi, sinphi, centerx, centery)\n\n    return { x1, y1, x2, y2, x, y }\n  })\n}\n\nexport default arcToBezier\n"],"names":["TAU","Math","PI","mapToEllipse","rx","ry","cosphi","sinphi","centerx","centery","x","y","xp","yp","approxUnitArc","ang1","ang2","a","tan","x1","cos","y1","sin","x2","y2","vectorAngle","ux","uy","vx","vy","sign","umag","sqrt","vmag","dot","div","acos","getArcCenter","px","py","cx","cy","largeArcFlag","sweepFlag","pxp","pyp","rxsq","pow","rysq","pxpsq","pypsq","radicant","centerxp","centeryp","vx1","vy1","vx2","vy2","arcToBezier","xAxisRotation","curves","abs","lambda","segments","max","ceil","i","push","map","curve"],"mappings":"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"}