{"version":3,"file":"svg-points-to-cubic-bezier.js","sources":["../src/index.js"],"sourcesContent":["const TAU = Math.PI * 2\n\nconst mapToEllipse = ({ x, y }, rx, ry, cosphi, sinphi, centerx, centery) => {\n  x *= rx\n  y *= ry\n\n  const xp = cosphi * x - sinphi * y\n  const yp = sinphi * x + cosphi * y\n\n  return {\n    x: xp + centerx,\n    y: yp + centery\n  }\n}\n\nconst approxUnitArc = (ang1, ang2) => {\n  // See http://spencermortensen.com/articles/bezier-circle/ for the derivation\n  // of this constant.\n  const c = 0.551915024494\n\n  const x1 = Math.cos(ang1)\n  const y1 = Math.sin(ang1)\n  const x2 = Math.cos(ang1 + ang2)\n  const y2 = Math.sin(ang1 + ang2)\n\n  return [\n    {\n      x: x1 - y1 * c,\n      y: y1 + x1 * c\n    },\n    {\n      x: x2 + y2 * c,\n      y: y2 - x2 * c\n    },\n    {\n      x: x2,\n      y: y2\n    }\n  ]\n}\n\nconst vectorAngle = (ux, uy, vx, vy) => {\n  const sign = (ux * vy - uy * vx < 0) ? -1 : 1\n  const umag = Math.sqrt(ux * ux + uy * uy)\n  const vmag = Math.sqrt(ux * ux + uy * uy)\n  const dot = ux * vx + uy * vy\n\n  let div = dot / (umag * vmag)\n\n  if (div > 1) {\n    div = 1\n  }\n\n  if (div < -1) {\n    div = -1\n  }\n\n  return sign * Math.acos(div)\n}\n\nconst getArcCenter = (\n  px,\n  py,\n  cx,\n  cy,\n  rx,\n  ry,\n  largeArcFlag,\n  sweepFlag,\n  sinphi,\n  cosphi,\n  pxp,\n  pyp\n) => {\n  const rxsq = Math.pow(rx, 2)\n  const rysq = Math.pow(ry, 2)\n  const pxpsq = Math.pow(pxp, 2)\n  const pypsq = Math.pow(pyp, 2)\n\n  let radicant = (rxsq * rysq) - (rxsq * pypsq) - (rysq * pxpsq)\n\n  if (radicant < 0) {\n    radicant = 0\n  }\n\n  radicant /= (rxsq * pypsq) + (rysq * pxpsq)\n  radicant = Math.sqrt(radicant) * (largeArcFlag === sweepFlag ? -1 : 1)\n\n  const centerxp = radicant * rx / ry * pyp\n  const centeryp = radicant * -ry / rx * pxp\n\n  const centerx = cosphi * centerxp - sinphi * centeryp + (px + cx) / 2\n  const centery = sinphi * centerxp + cosphi * centeryp + (py + cy) / 2\n\n  const vx1 = (pxp - centerxp) / rx\n  const vy1 = (pyp - centeryp) / ry\n  const vx2 = (-pxp - centerxp) / rx\n  const vy2 = (-pyp - centeryp) / ry\n\n  let ang1 = vectorAngle(1, 0, vx1, vy1)\n  let ang2 = vectorAngle(vx1, vy1, vx2, vy2)\n\n  if (sweepFlag === 0 && ang2 > 0) {\n    ang2 -= TAU\n  }\n\n  if (sweepFlag === 1 && ang2 < 0) {\n    ang2 += TAU\n  }\n\n  return [ centerx, centery, ang1, ang2 ]\n}\n\nconst arcToBezier = ({\n  px,\n  py,\n  cx,\n  cy,\n  rx,\n  ry,\n  xAxisRotation = 0,\n  largeArcFlag = 0,\n  sweepFlag = 0\n}) => {\n  const curves = []\n\n  if (rx === 0 || ry === 0) {\n    return []\n  }\n\n  const sinphi = Math.sin(xAxisRotation * TAU / 360)\n  const cosphi = Math.cos(xAxisRotation * TAU / 360)\n\n  const pxp = cosphi * (px - cx) / 2 + sinphi * (py - cy) / 2\n  const pyp = -sinphi * (px - cx) / 2 + cosphi * (py - cy) / 2\n\n  if (pxp === 0 && pyp === 0) {\n    return []\n  }\n\n  rx = Math.abs(rx)\n  ry = Math.abs(ry)\n\n  const lambda =\n    Math.pow(pxp, 2) / Math.pow(rx, 2) +\n    Math.pow(pyp, 2) / Math.pow(ry, 2)\n\n  if (lambda > 1) {\n    rx *= Math.sqrt(lambda)\n    ry *= Math.sqrt(lambda)\n  }\n\n  let [ centerx, centery, ang1, ang2 ] = getArcCenter(\n    px,\n    py,\n    cx,\n    cy,\n    rx,\n    ry,\n    largeArcFlag,\n    sweepFlag,\n    sinphi,\n    cosphi,\n    pxp,\n    pyp\n  )\n\n  const segments = Math.max(Math.ceil(Math.abs(ang2) / (TAU / 4)), 1)\n\n  ang2 /= segments\n\n  for (let i = 0; i < segments; i++) {\n    curves.push(approxUnitArc(ang1, ang2))\n    ang1 += ang2\n  }\n\n  return curves.map(curve => {\n    const { x: x1, y: y1 } = mapToEllipse(curve[ 0 ], rx, ry, cosphi, sinphi, centerx, centery)\n    const { x: x2, y: y2 } = mapToEllipse(curve[ 1 ], rx, ry, cosphi, sinphi, centerx, centery)\n    const { x, y } = mapToEllipse(curve[ 2 ], rx, ry, cosphi, sinphi, centerx, centery)\n\n    return { x1, y1, x2, y2, x, y }\n  })\n}\n\nexport default arcToBezier\n"],"names":["TAU","Math","PI","mapToEllipse","rx","ry","cosphi","sinphi","centerx","centery","x","y","xp","yp","approxUnitArc","ang1","ang2","c","x1","cos","y1","sin","x2","y2","vectorAngle","ux","uy","vx","vy","sign","umag","sqrt","vmag","dot","div","acos","getArcCenter","px","py","cx","cy","largeArcFlag","sweepFlag","pxp","pyp","rxsq","pow","rysq","pxpsq","pypsq","radicant","centerxp","centeryp","vx1","vy1","vx2","vy2","arcToBezier","xAxisRotation","curves","abs","lambda","segments","max","ceil","i","push","map","curve"],"mappings":"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"}